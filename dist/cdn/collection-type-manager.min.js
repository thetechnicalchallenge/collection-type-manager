"use strict";var _sortablejs=_interopRequireDefault(require("sortablejs"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var CollectionTypeManager=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{containerId:null,addButtonId:null,removeButtonsClassName:null,isBuilt:null,afterAddElement:null,afterRemoveElement:null,enableSortable:!1,sortableConfig:{}};if(_classCallCheck(this,e),this.settings=t,this.container=document.getElementById(t.containerId),this.addButton=document.getElementById(t.addButtonId),this.removeButtons=Array.from(document.getElementsByClassName(t.removeButtonsClassName)),this.widgetPrototype=this.container.dataset.prototype,this.counter=this.container.dataset.counter,this.lastWidgetAdded=null,this.listenButtons(),t.enableSortable){var n=this.sortOnEnd(t.sortableConfig);this.sortable=_sortablejs.default.create(this.container,n)}this.fields=[],this.sortFieldNames(),t.isBuilt instanceof Function&&t.isBuilt()}return _createClass(e,[{key:"sortOnEnd",value:function(e){var t=this,n={};return e&&e.hasOwnProperty("onEnd")?n.onEnd=function(){t.sortFieldNames(),e.onEnd()}:n.onEnd=function(e){t.sortFieldNames()},n}},{key:"getFields",value:function(){return this.fields}},{key:"sortFieldNames",value:function(){var e=this;this.fields=[],Array.from(this.container.children).forEach(function(t,n){Array.from(t.querySelectorAll("select, textarea, input")).forEach(function(t){t.name=t.name.replace(/\[(\d+)\]/g,"[".concat(n,"]")),e.fields.push(t)})})}},{key:"getContainer",value:function(){return this.container}},{key:"getSortable",value:function(){return this.settings.enableSortable||console.log(new Error('You must set "enableSortable" to true for using this feature.')),this.sortable}},{key:"listenButtons",value:function(){var e=this;this.addButton.addEventListener("click",this.addElement.bind(this)),this.removeButtons.forEach(function(t,n){t.addEventListener("click",e.removeElement.bind(e,t))})}},{key:"addElement",value:function(){var e=document.createElement("div");e.innerHTML=this.widgetPrototype.replace(/__name__/g,this.counter);var t=e.children[0].getElementsByClassName(this.settings.removeButtonsClassName)[0];t.addEventListener("click",this.removeElement.bind(this,t)),this.lastWidgetAdded=e.children[0],this.container.appendChild(e.children[0]),this.counter++,this.sortFieldNames(),this.settings.afterAddElement instanceof Function&&this.settings.afterAddElement()}},{key:"getLastWidgetAdded",value:function(){return this.lastWidgetAdded}},{key:"removeElement",value:function(e){var t=document.getElementById(e.dataset.target);e.removeEventListener("click",this.removeElement.bind(this,e)),this.container.removeChild(t),this.settings.afterRemoveElement instanceof Function&&this.settings.afterRemoveElement()}}]),e}();